<template>
  <BaseCard
    :title="'Logger System'"
    :icon="'ðŸ“‹'"
    :is-loading="isLoading"
    :error="error"
    :main-stat="mainStat"
    :status-stats="statusStats"
    :last-update="formattedLastUpdate"
    loading-text="Lade Logger-Daten..."
    retry-text="Mock-Daten laden"
    refresh-text="Aktualisieren"
    refreshing-text="LÃ¤dt..."
    details-text="Details"
    last-update-text="Letzte Aktualisierung"
    @navigate="handleNavigate"
    @refresh="refreshData"
    @retry="handleRetry"
  />
</template>

<script setup lang="ts">
import { computed, onMounted } from 'vue'
import BaseCard from '../common/BaseCard.vue'
import {
  useLoggerSummary,
  LogCategory,
  getCategoryDisplayName,
  getCategoryIcon,
} from './useLoggerSummary'

// Props
defineProps<{
  module: {
    id: string
    title: string
    icon: string
    description: string
  }
}>()

const emit = defineEmits<{
  navigate: []
}>()

// Use composable
const {
  loading: isLoading,
  error,
  statistics,
  formattedLastUpdate,
  loadLogStatistics,
} = useLoggerSummary()

// Computed properties
const mainStat = computed(() => ({
  value: statistics.value.total,
  label: 'EintrÃ¤ge',
}))

const statusStats = computed(() => [
  {
    key: 'systemErrors',
    value: statistics.value.systemErrors,
    label: getCategoryDisplayName(LogCategory.SYSTEM_ERROR),
    icon: getCategoryIcon(LogCategory.SYSTEM_ERROR),
    type: 'error' as const,
  },
  {
    key: 'failedLogins',
    value: statistics.value.failedLogins,
    label: getCategoryDisplayName(LogCategory.FAILED_LOGIN),
    icon: getCategoryIcon(LogCategory.FAILED_LOGIN),
    type: 'warning' as const,
  },
  {
    key: 'emailsSent',
    value: statistics.value.emailsSent,
    label: getCategoryDisplayName(LogCategory.EMAIL_SENT),
    icon: getCategoryIcon(LogCategory.EMAIL_SENT),
    type: 'info' as const,
  },
  {
    key: 'successfulLogins',
    value: statistics.value.successfulLogins,
    label: getCategoryDisplayName(LogCategory.SUCCESSFUL_LOGIN),
    icon: getCategoryIcon(LogCategory.SUCCESSFUL_LOGIN),
    type: 'success' as const,
  },
  {
    key: 'personViewed',
    value: statistics.value.personViewed,
    label: getCategoryDisplayName(LogCategory.PERSON_VIEWED),
    icon: getCategoryIcon(LogCategory.PERSON_VIEWED),
    type: 'info' as const,
  },
])

// formattedLastUpdate is provided by the composable

// Methods
const refreshData = () => {
  loadLogStatistics(3) // Load last 3 days
}

const handleNavigate = () => {
  emit('navigate')
}

const handleRetry = () => {
  loadLogStatistics(3)
}

// Initialize component
onMounted(() => {
  loadLogStatistics(3) // Load statistics for last 3 days
})
</script>
