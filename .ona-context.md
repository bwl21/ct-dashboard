# Ona Context - ChurchTools Dashboard

## Project Overview
Vue 3 + TypeScript ChurchTools extension for dashboard functionality with modular card-based architecture.

## Critical API Patterns

### ChurchTools Client API ⚠️
**ALWAYS use correct pattern - common mistake to avoid:**

✅ **Correct:**
```typescript
churchtoolsClient.get('/api/endpoint', { param1: 'value1', param2: 'value2' })
```

❌ **Wrong:**
```typescript
churchtoolsClient.get('/api/endpoint', { params: { param1: 'value1' } })
```

**Key:** Second parameter is **directly** the params object, NOT nested in "params" key.

### ChurchTools Client HTTP Methods ⚠️
**CRITICAL: Use correct method names - common runtime error:**

✅ **Correct:**
```typescript
churchtoolsClient.get()       // GET requests
churchtoolsClient.post()      // POST requests  
churchtoolsClient.put()       // PUT requests
churchtoolsClient.deleteApi() // DELETE requests ⚠️ NOT .delete()!
churchtoolsClient.patch()     // PATCH requests
```

❌ **Wrong:**
```typescript
churchtoolsClient.delete()    // ERROR: "delete is not a function"
```

**Key:** DELETE operations use `deleteApi()` method, NOT `delete()`!

### Tags API Specifics ⚠️
**Modern Tags API returns data directly as array:**

✅ **Correct:**
```typescript
const response = await churchtoolsClient.get<Tag[]>('/tags/person')
// response is directly Tag[], not { data: Tag[] }
const tags = Array.isArray(response) ? response : []
```

❌ **Wrong:**
```typescript
const response = await churchtoolsClient.get('/tags/person')
const tags = response.data // ERROR: response.data is undefined
```

**Supported domains:** `'person' | 'song' | 'group'` (NOT `'appointment'`)

**Tag Updates:** Use `PUT /tags/{tagId}` with ALL required fields:
```typescript
const tagData = {
  name: tag.name,
  description: tag.description || '', // Required, use empty string not undefined
  color: tag.color || 'basic'          // Required, use default color not undefined
}
await churchtoolsClient.put(`/tags/${tagId}`, tagData)
```

## Project Structure
```
src/
├── components/
│   ├── common/           # Shared components (BaseCard, Start)
│   ├── automatic-groups/ # Automatic groups module
│   ├── expiring-appointments/ # Expiring appointments module
│   ├── tags/            # Tags module
│   ├── user-statistics/ # User statistics module
│   └── beispiel/        # Example module
├── services/            # API services
└── types/              # TypeScript definitions
```

## Development Guidelines

### Component Architecture
- Each module has Card + Admin components
- All cards extend BaseCard for consistency
- Import BaseCard from `../common/BaseCard.vue`
- ColorPicker available for ChurchTools color selection
- Use `v-model` for two-way binding with ColorPicker

### TagsAdmin Advanced Features
**Implemented advanced label management capabilities:**
- **Regex Filter**: Filter tags by name, description, or domain using regular expressions
- **Row Selection**: Checkbox selection for individual tags and "select all" functionality
- **Bulk Operations**: Apply colors to multiple selected tags simultaneously
- **Real-time Validation**: Regex error handling and filter result counts
- **Responsive Design**: Mobile-friendly layout for all new features

### Code Style
- Follow existing patterns in the codebase
- Use TypeScript strictly
- Maintain consistent import paths after component reorganization

### Git Workflow
- Use conventional commits: `feat:`, `fix:`, `refactor:`
- Add co-author: `Co-authored-by: Ona <no-reply@ona.com>`
- Never commit unless explicitly requested

### Vite Configuration
- .env files excluded from watch to prevent unnecessary restarts
- Dev server runs on port 5173
- Use exec_preview for development servers

## Common Pitfalls
1. **ChurchTools API**: Don't nest params in "params" object
2. **Tags API**: Response is direct array, not nested in "data" property
3. **Button types**: Always use `type="button"` to prevent form submission
4. **Import paths**: Update after component moves
5. **BaseCard imports**: Use relative paths from module directories
6. **Package.json imports**: Adjust depth after directory changes

## API Documentation
- **ChurchTools OpenAPI Spec**: https://bgkorntal-routinen-beta.church.tools/system/runtime/swagger/openapi.json
  - Use this URL to check correct API endpoints, methods, and request/response schemas
  - Essential for debugging API integration issues

## Reference Files
- `docs/DEVELOPMENT_NOTES.md` - Detailed development guidelines
- `src/services/churchtools.ts` - Correct API usage examples
- `src/components/common/BaseCard.vue` - Base component architecture
- `src/components/common/ColorPicker.vue` - ChurchTools color picker component
- `src/components/common/ColorPickerExample.vue` - ColorPicker usage examples