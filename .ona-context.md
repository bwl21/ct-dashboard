# Ona Context - ChurchTools Dashboard

## Project Overview
Vue 3 + TypeScript ChurchTools extension for dashboard functionality with modular card-based architecture.

## Critical API Patterns

### ChurchTools Client API ‚ö†Ô∏è
**ALWAYS use correct pattern - common mistake to avoid:**

‚úÖ **Correct:**
```typescript
churchtoolsClient.get('/api/endpoint', { param1: 'value1', param2: 'value2' })
```

‚ùå **Wrong:**
```typescript
churchtoolsClient.get('/api/endpoint', { params: { param1: 'value1' } })
```

### Key Development Patterns

#### BaseCard Component Usage
```typescript
// Standard BaseCard implementation
<BaseCard
  :title="'Module Name'"
  :icon="'üìã'"
  :is-loading="loading"
  :main-stat="{ value: total, label: 'Eintr√§ge' }"
  :status-stats="categoryStats"
  @refresh="refreshData"
  @navigate="handleNavigate"
/>
```

#### AdminTable Component Usage
```typescript
// AdminTable with custom slots
<AdminTable
  :data="filteredData"
  :columns="tableColumns"
  :loading="loading"
  searchable
  @retry="refreshData"
>
  <template #actions>
    <button class="ct-btn ct-btn-primary">Action</button>
  </template>
  
  <template #cell-actions="{ item }">
    <button class="ct-btn ct-btn-sm ct-btn-outline">Details</button>
  </template>
</AdminTable>
```

## Architecture Guidelines

### Component Structure
```
src/components/
‚îú‚îÄ‚îÄ common/
‚îÇ   ‚îú‚îÄ‚îÄ BaseCard.vue          # Reusable card component
‚îÇ   ‚îú‚îÄ‚îÄ AdminTable.vue        # Data table with filtering
‚îÇ   ‚îî‚îÄ‚îÄ Toast.vue             # Notification system
‚îú‚îÄ‚îÄ [module-name]/
‚îÇ   ‚îú‚îÄ‚îÄ [Module]Card.vue      # Dashboard card
‚îÇ   ‚îú‚îÄ‚îÄ [Module]Admin.vue     # Admin panel
‚îÇ   ‚îî‚îÄ‚îÄ use[Module].ts        # Composable logic
```

### Styling Conventions
- Use ChurchTools design system classes: `ct-btn`, `ct-card`, `ct-select`
- CSS custom properties for consistent theming
- Responsive design with mobile-first approach

### TypeScript Patterns
```typescript
// Interface definitions
interface ModuleData {
  id: string
  name: string
  status: 'active' | 'inactive'
}

// Composable pattern
export function useModule() {
  const loading = ref(false)
  const data = ref<ModuleData[]>([])
  
  const loadData = async () => {
    loading.value = true
    try {
      data.value = await churchtoolsClient.get('/api/modules')
    } finally {
      loading.value = false
    }
  }
  
  return { loading, data, loadData }
}
```

## Common Development Tasks

### Adding New Module
1. Create module directory in `src/components/`
2. Implement Card component using BaseCard
3. Implement Admin component using AdminTable
4. Create composable for data logic
5. Add route to App.vue
6. Update documentation

### API Integration
- Use `@churchtools/churchtools-client` for all API calls
- Implement proper error handling
- Use TypeScript interfaces for API responses
- Follow RESTful patterns

### Testing Considerations
- Test component props and events
- Mock ChurchTools API calls
- Verify responsive behavior
- Check accessibility compliance

## Performance Guidelines

### Bundle Optimization
- Use dynamic imports for admin panels
- Implement proper tree shaking
- Minimize external dependencies
- Optimize images and assets

### Runtime Performance
- Use Vue 3 reactivity efficiently
- Implement virtual scrolling for large datasets
- Cache API responses when appropriate
- Debounce user input for search/filter

## Security Best Practices

### Environment Variables
- Never commit real credentials
- Use `.env-example` for templates
- Validate environment configuration

### API Security
- Leverage ChurchTools session authentication
- Validate user permissions
- Sanitize user inputs
- Handle errors gracefully

## Deployment Notes

### Build Process
```bash
npm run build    # Production build
npm run deploy   # Build + package for ChurchTools
```

### ChurchTools Integration
- Plugin key: `ct-dashboard`
- Base URL: `/ccm/ct-dashboard/`
- Automatic session handling
- No additional authentication required

## Troubleshooting

### Common Issues
1. **API calls failing**: Check ChurchTools session and permissions
2. **Build errors**: Clear node_modules and reinstall
3. **Styling issues**: Verify ChurchTools CSS classes
4. **Performance**: Check for memory leaks in reactive data

### Debug Tools
- Vue DevTools for component inspection
- Network tab for API monitoring
- Console for error tracking
- Lighthouse for performance analysis